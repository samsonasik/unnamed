## Customize the test machine
machine:

  timezone:
    Europe/Sofia # Set the timezone

  # Version of php to use
  php:
    version: 5.5.28
  node:
    version: 2.14.3

## Customize dependencies
dependencies:
  pre:
    - mysql -u ubuntu -e 'create database IF NOT EXISTS xj;'
    - cp config/autoload/doctrine.local.php.dist config/autoload/doctrine.local.php

  override:
    - chmod -R 777 data/logs
    - mkdir -p build/coverage
    - mkdir -p build/logs
    - sudo apt-get install parallel
    - sudo apt-get install nodejs npm
    - composer install --otpimize-autoloader

  # we automatically cache and restore many dependencies between
  # builds. If you need to, you can add custom paths to cache:
  cache_directories:
    - "vendor"   # relative to the build directory

## Customize test commands
test:
  override:
  - ls -d module/*/test/PHPUnit | parallel --gnu --keep-order 'echo "Running {} tests"; ./vendor/bin/phpunit -c {}/phpunit.xml;' || exit 1
  - cd ..
